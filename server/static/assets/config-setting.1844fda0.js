import{_ as Y}from"./AutoSettings.558f1ecb.js";import{K as Z,O as f,aQ as ee,o as S,aR as te,P as k,as as U,Q as h,a1 as L,D as s,S as n,U as y,W as C,aD as x,aS as O,J as I,aT as ae,aF as le,a4 as p,aU as E,aV as oe,a0 as m,H as K,F as se,aH as re,aI as ne,T as F,_ as P,ar as j,R as J,a2 as ie,a3 as ue,aN as de,ax as M}from"./index.86ff0207.js";import{V as z}from"./VAutocomplete.1b5d03fa.js";import{V as ce}from"./VDialog.5ca391ab.js";import"./VCheckbox.6e9b5a02.js";import"./VCheckboxBtn.80f1dc55.js";import"./VTextarea.58b6c495.js";import"./VSelect.f389ef7d.js";const fe=m("span",{class:"text-h5"},"\u79BB\u7EBF\u6A21\u5F0F",-1),pe=m("br",null,null,-1),me=m("br",null,null,-1),ge={ref:"refForm",class:"d-flex flex-column justify-center gap-5"},ve={class:"d-flex flex-wrap gap-2"},_e=m("span",{class:"d-none d-sm-block"},"\u4E0A\u4F20\u914D\u7F6E\u6587\u4EF6",-1),be=m("small",null,"*\u53EF\u62D6\u5230\u914D\u7F6E\u6587\u4EF6\u5230\u7A97\u53E3",-1),ke={__name:"config-setting",setup(we){const i=Z(),g=f({chatConfig:{},redisConfig:{}}),D=f([]),V=f(),v=f(!1),_=f(!1),H=ee()["ALT+S"],Q=S(()=>i.getters.ws.message),N=S(()=>{let t=[];for(const e of D.value){t.push({name:e.title,path:e.id});for(const l of e.view)if(l.type.toLowerCase()==="tabs")for(const r of l.tabs)for(const o of r.view){let a={name:o.label,path:`${e.id}/${o.id||o.data}`};a.group=e.title,a.tab=r.tab,a.tabId=`${e.id}_${l.id}`,t.push(a)}else{let r={name:l.label,path:`${e.id}/${l.id||l.data}`};r.group=e.title,t.push(r)}}return t}),c=f(!1),A=()=>{c.value=!1,k.post(`${i.getters.serverApi}sysconfig`,{token:i.getters.userToken}).then(t=>{t.data&&(t.data.error?i.commit("app/ADD_SNACKBAR",{message:t.data.error,color:"error"}):g.value=t.data)}).catch(t=>{c.value=!0,i.commit("app/ADD_SNACKBAR",{message:t.message,color:"error"}),console.log(t)})},q=t=>{if(i.getters.runmode==="online")k.post(`${i.getters.serverApi}saveconfig`,{token:i.getters.userToken,...t}).then(e=>{var l;(l=e.data)!=null&&l.error?i.commit("app/ADD_SNACKBAR",{message:e.data.error,color:"error"}):i.commit("app/ADD_SNACKBAR",{message:"\u4FDD\u5B58\u6210\u529F",color:"success"}),A()}).catch(e=>{A(),i.commit("app/ADD_SNACKBAR",{message:e.message,color:"error"}),console.log(e)});else{const e=(d,w)=>{let G=typeof d=="object",X=typeof w=="object";return G?(X&&[...Object.keys(w),...Object.getOwnPropertySymbols(w)].forEach(R=>{d[R]=e(d[R],w[R])}),d):w},l=e(g.value,t),r=JSON.stringify(l),o=new Blob([r],{type:"application/json"}),a=URL.createObjectURL(o),u=document.createElement("a");u.href=a,u.download="config.json",document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(a)}},B=async t=>{if(v.value&&(v.value=!1,await M()),t.tab){let l=b.value;l[t.tabId]=t.tab,b.value=l,await M()}const e=document.getElementById(t.path);if(e){let l=function(r){return r?r.offsetTop+l(r.offsetParent):0};window.scrollTo({top:l(e)-60,behavior:"smooth"})}},$=f(),W=t=>{const e=new FileReader,{files:l}=t.target;l&&l.length&&(e.readAsText(l[0],"UTF-8"),e.onload=()=>{if(typeof e.result=="string")try{g.value=JSON.parse(e.result),_.value=!1,c.value=!0}catch(r){i.commit("app/ADD_SNACKBAR",{message:r.message,color:"error"})}})},T=S({get(){return g.value},set(t){g.value[t.mode][t.data]=t.value;let e={};e[t.mode]={},e[t.mode][t.data]=t.value,q(e)}}),b=f({});if(te([H,Q,g],([t,e,l],[r,o,a])=>{t&&(v.value=!0),e!=o&&e&&JSON.parse(e).notice==="updateConfig"&&A(),l!=a&&l&&c.value==!1&&(c.value=!0)}),k.post(`${i.getters.serverApi}settingView`,{token:i.getters.userToken}).then(t=>{if(t.data)if(t.data.err)i.commit("app/ADD_SNACKBAR",{message:t.data.err,color:"error"});else{D.value=t.data;for(const e of t.data){const l=e.view.filter(r=>r.type.toLowerCase()==="tabs");for(const r of l)b.value[`${e.id}_${r.id}`]=r.tabs[0].tab}}}).catch(t=>{c.value=!0,i.commit("app/ADD_SNACKBAR",{message:t.message,color:"error"}),console.log(t)}),i.getters.runmode==="online")A();else{const t=document.querySelector("body"),e=l=>{if(l.preventDefault(),event.type==="drop"){const r=l.dataTransfer.files,o=new FileReader;r&&r.length&&(o.readAsText(r[0],"UTF-8"),o.onload=()=>{if(typeof o.result=="string")try{const a=JSON.parse(o.result);D.value=a.view,g.value={chatConfig:a.chatConfig,redisConfig:a.redisConfig},_.value=!1,c.value=!0}catch(a){i.commit("app/ADD_SNACKBAR",{message:a.message,color:"error"})}})}};t.addEventListener("drop",e),t.addEventListener("dragenter",e),t.addEventListener("dragover",e),t.addEventListener("dragleave",e),_.value=!0}return(t,e)=>{const l=U("masonry-tile"),r=U("masonry");return h(),L("div",null,[s(ae,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=o=>v.value=o),class:"align-center justify-center"},{default:n(()=>[s(y,{"min-width":"600"},{default:n(()=>[s(C,null,{default:n(()=>[s(z,{"onUpdate:modelValue":[B,e[0]||(e[0]=o=>V.value=o)],modelValue:V.value,items:x(N),"return-object":"","auto-select-first":"","item-title":"name","item-value":"path",label:"\u641C\u7D22",autofocus:""},{item:n(({props:o,item:a})=>{var u,d;return[s(O,I(o,{title:(u=a==null?void 0:a.raw)==null?void 0:u.name,subtitle:(d=a==null?void 0:a.raw)==null?void 0:d.group}),null,16,["title","subtitle"])]}),_:1},8,["modelValue","items"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(ce,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=o=>_.value=o),app:"",persistent:"",width:"auto"},{default:n(()=>[s(y,null,{default:n(()=>[s(le,null,{default:n(()=>[fe]),_:1}),s(C,null,{default:n(()=>[p(" \u5F53\u524D\u4E3A\u79BB\u7EBF\u6A21\u5F0F\uFF0C\u8BF7\u4E0A\u4F20\u914D\u7F6E\u6587\u4EF6\u540E\u518D\u4F7F\u7528\u3002"),pe,p(" \u914D\u7F6E\u6587\u4EF6\u53EF\u79C1\u804A\u673A\u5668\u4EBA"),s(E,{label:"",size:"x-small"},{default:n(()=>[p("#chatgpt\u5BFC\u51FA\u914D\u7F6E")]),_:1}),p("\u83B7\u53D6 "),me,p(" \u4FDD\u5B58\u540E\u7684\u914D\u7F6E\u6587\u4EF6\u53EF\u79C1\u804A\u673A\u5668\u4EBA"),s(E,{label:"",size:"x-small"},{default:n(()=>[p("#chatgpt\u5BFC\u5165\u914D\u7F6E")]),_:1}),p("\u5BFC\u5165 "),s(oe,null,{default:n(()=>[m("form",ge,[m("div",ve,[s(K,{color:"primary",onClick:e[2]||(e[2]=o=>{var a;return(a=$.value)==null?void 0:a.click()})},{default:n(()=>[s(se,{icon:"mdi-cloud-upload-outline",class:"d-sm-none"}),_e]),_:1}),m("input",{ref_key:"refInputEl",ref:$,type:"file",name:"file",accept:".json",hidden:"",onInput:W},null,544)])],512)]),_:1}),be]),_:1}),s(re,null,{default:n(()=>[s(ne),s(K,{color:"blue-darken-1",variant:"text",onClick:e[3]||(e[3]=o=>t.$router.push({path:"/"}))},{default:n(()=>[p(" \u8FD4\u56DE ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(P,null,{default:n(()=>[s(F,{cols:"12"},{default:n(()=>[s(y,null,{default:n(()=>[s(C,null,{default:n(()=>[s(z,{"onUpdate:modelValue":[B,e[5]||(e[5]=o=>V.value=o)],modelValue:V.value,items:x(N),"return-object":"","auto-select-first":"","item-title":"name","item-value":"path",label:"\u641C\u7D22"},{item:n(({props:o,item:a})=>{var u,d;return[s(O,I(o,{title:(u=a==null?void 0:a.raw)==null?void 0:u.name,subtitle:(d=a==null?void 0:a.raw)==null?void 0:d.group}),null,16,["title","subtitle"])]}),_:1},8,["modelValue","items"])]),_:1})]),_:1})]),_:1})]),_:1}),j((h(),J(P,null,{default:n(()=>[(h(!0),L(ie,null,ue(D.value,o=>j((h(),J(F,{key:o.id,cols:"12",md:"6"},{default:n(()=>[s(y,{title:o.title},{default:n(()=>[s(C,null,{default:n(()=>[s(Y,{initData:c.value,viewId:o.id,viewData:o.view,configData:x(T),"onUpdate:configData":e[6]||(e[6]=a=>de(T)?T.value=a:null),activeTab:b.value,"onUpdate:activeTab":e[7]||(e[7]=a=>b.value=a)},null,8,["initData","viewId","viewData","configData","activeTab"])]),_:2},1024)]),_:2},1032,["title"])]),_:2},1024)),[[l]])),128))]),_:1})),[[r]])])}}};export{ke as default};
