import{p as J,b as z,bp as Y,bq as Z,bg as X,n as ee,v as te,ag as ae,u as le,C as se,o as k,O as _,ao as oe,aR as K,a$ as ne,ac as ue,ai as re,D as o,a2 as ie,bk as ce,J as $,aT as de,br as H,bs as M,K as pe,L as me,M as ve,bt as fe,Q as q,a1 as ge,S as m,aE as he,a0 as y,aD as C,bu as be,aF as _e,a4 as W,R as N,bv as ye,a7 as ke,a6 as U,W as Q,Z as Ae,aO as we,_ as Ve,T as S,$ as F,H as xe,Y as j,U as Se,aC as I,P as O}from"./index.a457a291.js";import{a as De,b as Re,c as Te,d as qe}from"./auth-v1-tree.f5524167.js";import{m as Ce}from"./md5.20cf1e4a.js";import{b as G}from"./route-block.7577f022.js";const Pe=J({autofocus:Boolean,divider:String,focusAll:Boolean,label:{type:String,default:"$vuetify.input.otp"},length:{type:[Number,String],default:6},modelValue:{type:[Number,String],default:void 0},placeholder:String,type:{type:String,default:"text"},...z(),...Y(),...Z(X({variant:"outlined"}),["baseColor","bgColor","class","color","disabled","error","loading","rounded","style","theme","variant"])},"VOtpInput"),Be=ee()({name:"VOtpInput",props:Pe(),emits:{finish:n=>!0,"update:focused":n=>!0,"update:modelValue":n=>!0},setup(n,l){let{attrs:A,emit:D,slots:g}=l;const{dimensionStyles:u}=te(n),{isFocused:r,focus:w,blur:V}=ae(n),s=le(n,"modelValue","",a=>String(a).split(""),a=>a.join("")),{t:E}=se(),L=k(()=>Array(Number(n.length)).fill(0)),c=_(-1),R=_(),b=_([]),P=k(()=>b.value[c.value]);function B(){const a=s.value.slice(),p=P.value.value;a[c.value]=p,s.value=a;let h=null;c.value>s.value.length?h=s.value.length+1:c.value+1!==Number(n.length)?h="next":requestAnimationFrame(()=>{var v;return(v=P.value)==null?void 0:v.blur()}),h&&M(R.value,h)}function i(a){const p=s.value.slice(),h=c.value;let v=null;!["ArrowLeft","ArrowRight","Backspace","Delete"].includes(a.key)||(a.preventDefault(),a.key==="ArrowLeft"?v="prev":a.key==="ArrowRight"?v="next":["Backspace","Delete"].includes(a.key)&&(p[c.value]="",s.value=p,c.value>0&&a.key==="Backspace"?v="prev":requestAnimationFrame(()=>{b.value[h].select()})),requestAnimationFrame(()=>{v!=null&&M(R.value,v)}))}function e(a,p){var h,v,f;p.preventDefault(),p.stopPropagation(),s.value=((v=(h=p==null?void 0:p.clipboardData)==null?void 0:h.getData("Text"))!=null?v:"").split(""),(f=b.value)==null||f[a].blur()}function t(){s.value=[]}function d(a,p){w(),c.value=p}function x(){V(),c.value=-1}return oe({VField:{disabled:k(()=>n.disabled),error:k(()=>n.error),variant:k(()=>n.variant)}},{scoped:!0}),K(s,a=>{a.length===n.length&&D("finish",a.join(""))},{deep:!0}),K(c,a=>{a<0||ne&&window.requestAnimationFrame(()=>{b.value[a].select()})}),ue(()=>{var h;const[a,p]=re(A);return o("div",$({class:["v-otp-input",{"v-otp-input--divided":!!n.divider},n.class],style:[n.style]},a),[o("div",{ref:R,class:"v-otp-input__content",style:[u.value]},[L.value.map((v,f)=>o(ie,null,[n.divider&&f!==0&&o("span",{class:"v-otp-input__divider"},[n.divider]),o(ce,{focused:r.value&&n.focusAll||c.value===f,key:f},{...g,default:()=>o("input",{ref:T=>b.value[f]=T,"aria-label":E(n.label,f+1),autofocus:f===0&&n.autofocus,autocomplete:"one-time-code",class:["v-otp-input__field"],inputmode:"text",min:n.type==="number"?0:void 0,maxlength:"1",placeholder:n.placeholder,type:n.type,value:s.value[f],onInput:B,onFocus:T=>d(T,f),onBlur:x,onKeydown:i,onPaste:T=>e(f,T)},null)})])),o("input",$({class:"v-otp-input-input",type:"hidden"},p,{value:s.value.join("")}),null),o(de,{contained:!0,"content-class":"v-otp-input__loader","model-value":!!n.loading,persistent:!0},{default:()=>{var v,f;return[(f=(v=g.loader)==null?void 0:v.call(g))!=null?f:o(H,{color:typeof n.loading=="boolean"?void 0:n.loading,indeterminate:!0,size:"24",width:"2"},null)]}}),(h=g.default)==null?void 0:h.call(g)])])}),{blur:()=>{var a;(a=b.value)==null||a.some(p=>p.blur())},focus:()=>{var a;(a=b.value)==null||a[0].focus()},reset:t,isFocused:r}}});const Ne={class:"auth-wrapper d-flex align-center justify-center pa-4 app-bar-region"},Ue={class:"d-flex"},Ee=["innerHTML"],Le=y("h5",{class:"text-h5 font-weight-semibold mb-1"}," \u6B22\u8FCE\u4F7F\u7528GPT\u5DE5\u5177\u7BB1 \u{1F44B}\u{1F3FB} ",-1),Fe=y("p",{class:"mb-0"}," \u8BF7\u5148\u767B\u9646\u670D\u52A1\u8D26\u53F7 ",-1),Ie=y("p",{class:"mb-0"}," \u5FEB\u6377\u767B\u5F55 ",-1),Oe=y("span",{class:"mx-4"},"or",-1),$e=y("span",null,"\u65E0\u6CD5\u8FDE\u63A5\u5230\u670D\u52A1\u5668\uFF1F",-1),Ke={__name:"login",setup(n){const l=pe(),A=me(),D=ve(),g=k(()=>l.getters.ws.client),u=_({title:"",color:"warning",icon:"mdi-alert-circle-outline",text:""}),r=_({server:l.getters.serverApi,qq:"",password:"",remember:!1}),w=_(""),V=_(),s=_(!1),E=fe(),L=k(()=>E.global.name.value==="light"?De:Re),c=_(!1),R=()=>{const i=r.value;if(s.value=!0,!i.server||!i.qq||!i.password){u.value.title="\u767B\u5F55\u5931\u8D25",u.value.text="\u8BF7\u586B\u5199\u670D\u52A1\u5668\u3001QQ\u53F7\u548C\u5BC6\u7801\u540E\u518D\u767B\u5F55",s.value=!1;return}let e=i.server;try{!e.startsWith("http://")&&!e.startsWith("https://")&&(e="http://"+e),e=new URL(e).href}catch{u.value.title="\u767B\u5F55\u5931\u8D25",u.value.text="\u670D\u52A1\u5668\u5730\u5740\u683C\u5F0F\u9519\u8BEF",s.value=!1;return}const t=Ce(i.password);O.post(`${e}login`,{qq:i.qq,passwd:t}).then(d=>{if(d.data.login){if(l.getters.serverApi!=e||g.value.readyState!=1){const x=new URL(e),a=`${x.protocol==="http:"?"ws":"wss"}://${x.host}/ws`;l.dispatch("app/initWS",a)}l.commit("app/SET_RUNMODE","online"),l.commit("app/SET_APPSERVERAPI",e),d.data.guoba&&l.commit("app/SET_GUOBAAPI",d.data.guoba.remote[0]),l.dispatch("user/login",{user:i.qq,permissions:d.data.autho,token:d.data.token,guobaToken:d.data.guobaToken,auto:r.remember}),setTimeout(()=>{g.value.readyState==1?(g.value.send(JSON.stringify({command:"login",token:l.getters.userToken})),l.commit("app/ADD_SNACKBAR",{message:`${i.qq}\u767B\u9646\u6210\u529F`,color:"success"}),D.push({path:"/"})):(l.commit("app/ADD_SNACKBAR",{message:"ws\u94FE\u63A5\u5C1A\u672A\u5B8C\u6210\u521D\u59CB\u5316\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",color:"warning"}),s.value=!1)},1e3)}else r.value.password="",u.value.title="\u767B\u5F55\u5931\u8D25",u.value.text="\u7528\u6237\u540D\u6216\u5BC6\u7801\u9519\u8BEF",s.value=!1,l.commit("app/ADD_SNACKBAR",{message:"\u767B\u5F55\u5931\u8D25\uFF0C\u7528\u6237\u540D\u6216\u5BC6\u7801\u9519\u8BEF\uFF01",color:"error"})}).catch(d=>{u.value.title="\u670D\u52A1\u5668\u53D1\u751F\u5F02\u5E38",u.value.text=d.message,s.value=!1,l.commit("app/ADD_SNACKBAR",{message:"\u767B\u9646\u5931\u8D25\uFF0C\u670D\u52A1\u5668\u53D1\u751F\u5F02\u5E38\uFF01",color:"error"}),console.log(d)})},b=()=>{l.commit("app/SET_RUNMODE","offline"),l.commit("app/SET_APPSERVERAPI",""),l.dispatch("user/login",{user:"\u79BB\u7EBF\u7528\u6237",permissions:"",token:"",auto:!1}),D.push({path:"/"})},P=()=>{const i=r.value;if(s.value=!0,!i.server){u.value.title="\u767B\u5F55\u5931\u8D25",u.value.text="\u8BF7\u586B\u5199\u670D\u52A1\u5668\u540E\u518D\u767B\u5F55",s.value=!1;return}let e=i.server;try{!e.startsWith("http://")&&!e.startsWith("https://")&&(e="http://"+e),e=new URL(e).href}catch{u.value.title="\u767B\u5F55\u5931\u8D25",u.value.text="\u670D\u52A1\u5668\u5730\u5740\u683C\u5F0F\u9519\u8BEF",s.value=!1;return}O.post(`${e}quick`).then(t=>{s.value=!1,t.data.state?V.value=!0:(r.value.password="",u.value.title="\u767B\u5F55\u5931\u8D25",u.value.text="\u670D\u52A1\u5668\u9519\u8BEF",l.commit("app/ADD_SNACKBAR",{message:"\u767B\u5F55\u5931\u8D25\uFF0C\u670D\u52A1\u5668\u9519\u8BEF\uFF01",color:"error"}))}).catch(t=>{u.value.title="\u670D\u52A1\u5668\u53D1\u751F\u5F02\u5E38",u.value.text=t.message,s.value=!1,l.commit("app/ADD_SNACKBAR",{message:"\u767B\u9646\u5931\u8D25\uFF0C\u670D\u52A1\u5668\u53D1\u751F\u5F02\u5E38\uFF01",color:"error"}),console.log(t)})},B=()=>{s.value=!0;const i=r.value;let e=i.server;try{!e.startsWith("http://")&&!e.startsWith("https://")&&(e="http://"+e),e=new URL(e).href}catch{u.value.title="\u767B\u5F55\u5931\u8D25",u.value.text="\u670D\u52A1\u5668\u5730\u5740\u683C\u5F0F\u9519\u8BEF",s.value=!1;return}O.post(`${e}login`,{otp:w.value}).then(t=>{if(t.data.login){if(l.getters.serverApi!=e||g.value.readyState!=1){const d=new URL(e),x=`${d.protocol==="http:"?"ws":"wss"}://${d.host}/ws`;l.dispatch("app/initWS",x)}l.commit("app/SET_RUNMODE","online"),l.commit("app/SET_APPSERVERAPI",e),t.data.guoba&&l.commit("app/SET_GUOBAAPI",t.data.guoba.remote[0]),l.dispatch("user/login",{user:t.data.user,permissions:t.data.autho,token:t.data.token,guobaToken:t.data.guobaToken,auto:r.remember}),setTimeout(()=>{g.value.readyState==1?(g.value.send(JSON.stringify({command:"login",token:l.getters.userToken})),l.commit("app/ADD_SNACKBAR",{message:`${i.qq}\u767B\u9646\u6210\u529F`,color:"success"}),D.push({path:"/"})):(l.commit("app/ADD_SNACKBAR",{message:"ws\u94FE\u63A5\u5C1A\u672A\u5B8C\u6210\u521D\u59CB\u5316\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",color:"warning"}),s.value=!1)},1e3)}else r.value.password="",u.value.title="\u767B\u5F55\u5931\u8D25",u.value.text="\u7528\u6237\u540D\u6216\u5BC6\u7801\u9519\u8BEF",s.value=!1,l.commit("app/ADD_SNACKBAR",{message:"\u767B\u5F55\u5931\u8D25\uFF0C\u7528\u6237\u540D\u6216\u5BC6\u7801\u9519\u8BEF\uFF01",color:"error"})}).catch(t=>{u.value.title="\u670D\u52A1\u5668\u53D1\u751F\u5F02\u5E38",u.value.text=t.message,s.value=!1,l.commit("app/ADD_SNACKBAR",{message:"\u767B\u9646\u5931\u8D25\uFF0C\u670D\u52A1\u5668\u53D1\u751F\u5F02\u5E38\uFF01",color:"error"}),console.log(t)})};return A.query.server&&A.query.otp&&(r.value.server=A.query.server,w.value=A.query.otp,B()),(i,e)=>(q(),ge("div",Ne,[o(Se,{class:"auth-card pa-4 pt-7 app-bar-noregion","max-width":"448"},{default:m(()=>[o(he,{class:"justify-center"},{prepend:m(()=>[y("div",Ue,[y("div",{innerHTML:C(be)},null,8,Ee)])]),default:m(()=>[o(_e,{class:"font-weight-semibold text-2xl text-uppercase"},{default:m(()=>[W(" GPT\u5DE5\u5177\u7BB1 ")]),_:1})]),_:1}),u.value.title?(q(),N(ke,ye($({key:0},u.value)),null,16)):U("",!0),o(Q,{class:"pt-2"},{default:m(()=>[Le,Fe]),_:1}),o(Q,null,{default:m(()=>[o(Ae,{onSubmit:e[5]||(e[5]=we(()=>{},["prevent"]))},{default:m(()=>[o(Ve,null,{default:m(()=>[o(S,{cols:"12"},{default:m(()=>[o(F,{modelValue:r.value.server,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value.server=t),label:"\u670D\u52A1\u5668",type:"text","append-inner-icon":"mdi-fingerprint","onClick:appendInner":P},null,8,["modelValue"])]),_:1}),V.value?(q(),N(S,{key:0,cols:"12"},{default:m(()=>[Ie,o(C(Be),{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=t=>w.value=t),loading:s.value,onFinish:B},null,8,["modelValue","loading"])]),_:1})):U("",!0),V.value?U("",!0):(q(),N(S,{key:1,cols:"12"},{default:m(()=>[o(F,{modelValue:r.value.qq,"onUpdate:modelValue":e[2]||(e[2]=t=>r.value.qq=t),label:"QQ",type:"text"},null,8,["modelValue"])]),_:1})),V.value?U("",!0):(q(),N(S,{key:2,cols:"12"},{default:m(()=>[o(F,{modelValue:r.value.password,"onUpdate:modelValue":e[3]||(e[3]=t=>r.value.password=t),label:"\u5BC6\u7801",type:c.value?"text":"password","append-inner-icon":c.value?"mdi-eye-off-outline":"mdi-eye-outline","onClick:appendInner":e[4]||(e[4]=t=>c.value=!c.value),class:"mb-4"},null,8,["modelValue","type","append-inner-icon"]),o(xe,{block:"",type:"submit",loading:s.value,onClick:R},{loader:m(()=>[o(H,{indeterminate:"",color:"white"})]),default:m(()=>[W(" \u767B\u9646 ")]),_:1},8,["loading"])]),_:1})),o(S,{cols:"12",class:"d-flex align-center"},{default:m(()=>[o(j),Oe,o(j)]),_:1}),o(S,{cols:"12",class:"text-center text-base"},{default:m(()=>[$e,y("span",{class:"text-primary ms-2",onClick:b}," \u79BB\u7EBF\u4F7F\u7528 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(I,{class:"auth-footer-start-tree d-none d-md-block",src:C(Te),width:250},null,8,["src"]),o(I,{src:C(qe),class:"auth-footer-end-tree d-none d-md-block",width:350},null,8,["src"]),o(I,{class:"auth-footer-mask d-none d-md-block",src:C(L)},null,8,["src"])]))}};typeof G=="function"&&G(Ke);export{Ke as default};
