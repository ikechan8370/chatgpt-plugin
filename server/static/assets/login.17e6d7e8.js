import{p as z,b as G,bo as Y,bp as Z,bf as X,n as ee,v as te,ag as ae,u as le,C as se,o as A,O as b,ao as oe,aT as M,aU as ne,ac as ue,ai as ie,D as t,a2 as re,bj as de,J as O,b0 as ce,bq as J,br as L,K as pe,L as me,M as ve,bs as fe,Q as q,a1 as ge,S as d,aE as he,a0 as y,aD as N,bt as _e,aF as be,a4 as j,R as B,bu as we,a7 as ye,a6 as F,W as Q,Z as Ae,aN as Ve,_ as ke,T as S,$ as I,H as xe,Y as W,U as De,aC as $,P as K}from"./index.f985de17.js";import{a as Se,b as Re,c as Ce,d as Te}from"./auth-v1-tree.f5524167.js";import{m as qe}from"./md5.4f58303d.js";import{b as H}from"./route-block.7577f022.js";const Ne=z({autofocus:Boolean,divider:String,focusAll:Boolean,label:{type:String,default:"$vuetify.input.otp"},length:{type:[Number,String],default:6},modelValue:{type:[Number,String],default:void 0},placeholder:String,type:{type:String,default:"text"},...G(),...Y(),...Z(X({variant:"outlined"}),["baseColor","bgColor","class","color","disabled","error","loading","rounded","style","theme","variant"])},"VOtpInput"),Pe=ee()({name:"VOtpInput",props:Ne(),emits:{finish:s=>!0,"update:focused":s=>!0,"update:modelValue":s=>!0},setup(s,a){let{attrs:R,emit:w,slots:o}=a;const{dimensionStyles:u}=te(s),{isFocused:V,focus:k,blur:i}=ae(s),m=le(s,"modelValue","",e=>String(e).split(""),e=>e.join("")),{t:E}=se(),x=A(()=>Array(Number(s.length)).fill(0)),v=b(-1),C=b(),_=b([]),P=A(()=>_.value[v.value]);function f(){const e=m.value.slice(),r=P.value.value;e[v.value]=r,m.value=e;let g=null;v.value>m.value.length?g=m.value.length+1:v.value+1!==Number(s.length)?g="next":requestAnimationFrame(()=>{var c;return(c=P.value)==null?void 0:c.blur()}),g&&L(C.value,g)}function l(e){const r=m.value.slice(),g=v.value;let c=null;!["ArrowLeft","ArrowRight","Backspace","Delete"].includes(e.key)||(e.preventDefault(),e.key==="ArrowLeft"?c="prev":e.key==="ArrowRight"?c="next":["Backspace","Delete"].includes(e.key)&&(r[v.value]="",m.value=r,v.value>0&&e.key==="Backspace"?c="prev":requestAnimationFrame(()=>{_.value[g].select()})),requestAnimationFrame(()=>{c!=null&&L(C.value,c)}))}function n(e,r){var g,c,p;r.preventDefault(),r.stopPropagation(),m.value=((c=(g=r==null?void 0:r.clipboardData)==null?void 0:g.getData("Text"))!=null?c:"").split(""),(p=_.value)==null||p[e].blur()}function h(){m.value=[]}function D(e,r){k(),v.value=r}function U(){i(),v.value=-1}return oe({VField:{disabled:A(()=>s.disabled),error:A(()=>s.error),variant:A(()=>s.variant)}},{scoped:!0}),M(m,e=>{e.length===s.length&&w("finish",e.join(""))},{deep:!0}),M(v,e=>{e<0||ne&&window.requestAnimationFrame(()=>{_.value[e].select()})}),ue(()=>{var g;const[e,r]=ie(R);return t("div",O({class:["v-otp-input",{"v-otp-input--divided":!!s.divider},s.class],style:[s.style]},e),[t("div",{ref:C,class:"v-otp-input__content",style:[u.value]},[x.value.map((c,p)=>t(re,null,[s.divider&&p!==0&&t("span",{class:"v-otp-input__divider"},[s.divider]),t(de,{focused:V.value&&s.focusAll||v.value===p,key:p},{...o,default:()=>t("input",{ref:T=>_.value[p]=T,"aria-label":E(s.label,p+1),autofocus:p===0&&s.autofocus,autocomplete:"one-time-code",class:["v-otp-input__field"],inputmode:"text",min:s.type==="number"?0:void 0,maxlength:"1",placeholder:s.placeholder,type:s.type,value:m.value[p],onInput:f,onFocus:T=>D(T,p),onBlur:U,onKeydown:l,onPaste:T=>n(p,T)},null)})])),t("input",O({class:"v-otp-input-input",type:"hidden"},r,{value:m.value.join("")}),null),t(ce,{contained:!0,"content-class":"v-otp-input__loader","model-value":!!s.loading,persistent:!0},{default:()=>{var c,p;return[(p=(c=o.loader)==null?void 0:c.call(o))!=null?p:t(J,{color:typeof s.loading=="boolean"?void 0:s.loading,indeterminate:!0,size:"24",width:"2"},null)]}}),(g=o.default)==null?void 0:g.call(o)])])}),{blur:()=>{var e;(e=_.value)==null||e.some(r=>r.blur())},focus:()=>{var e;(e=_.value)==null||e[0].focus()},reset:h,isFocused:V}}});const Be={class:"auth-wrapper d-flex align-center justify-center pa-4 app-bar-region"},Fe={class:"d-flex"},Ee=["innerHTML"],Ue=y("h5",{class:"text-h5 font-weight-semibold mb-1"}," \u6B22\u8FCE\u4F7F\u7528GPT\u5DE5\u5177\u7BB1 \u{1F44B}\u{1F3FB} ",-1),Ie=y("p",{class:"mb-0"}," \u8BF7\u5148\u767B\u9646\u670D\u52A1\u8D26\u53F7 ",-1),$e=y("p",{class:"mb-0"}," \u5FEB\u6377\u767B\u5F55 ",-1),Ke=y("span",{class:"mx-4"},"or",-1),Oe=y("span",null,"\u65E0\u6CD5\u8FDE\u63A5\u5230\u670D\u52A1\u5668\uFF1F",-1),Me={__name:"login",setup(s){const a=pe();me();const R=ve(),w=A(()=>a.getters.ws.client),o=b({title:"",color:"warning",icon:"mdi-alert-circle-outline",text:""}),u=b({server:a.getters.serverApi,qq:"",password:"",remember:!1}),V=b(""),k=b(),i=b(!1),m=fe(),E=A(()=>m.global.name.value==="light"?Se:Re),x=b(!1),v=()=>{const f=u.value;if(i.value=!0,!f.qq||!f.password){o.value.title="\u767B\u5F55\u5931\u8D25",o.value.text="\u8BF7\u586B\u5199\u670D\u52A1\u5668\u3001QQ\u53F7\u548C\u5BC6\u7801\u540E\u518D\u767B\u5F55",i.value=!1;return}let l=window.location.origin+"/";const n=qe(f.password);K.post(`${l}login`,{qq:f.qq,passwd:n}).then(h=>{if(h.data.login){if(a.getters.serverApi!=l||w.value.readyState!=1){const D=new URL(l),U=`${D.protocol==="http:"?"ws":"wss"}://${D.host}/ws`;a.dispatch("app/initWS",U)}a.commit("app/SET_RUNMODE","online"),a.commit("app/SET_APPSERVERAPI",l),a.dispatch("user/login",{user:f.qq,permissions:h.data.autho,token:h.data.token,auto:u.remember}),setTimeout(()=>{w.value.readyState==1?(w.value.send(JSON.stringify({command:"login",token:a.getters.userToken})),a.commit("app/ADD_SNACKBAR",{message:`${f.qq}\u767B\u9646\u6210\u529F`,color:"success"}),R.push({path:"/"})):(a.commit("app/ADD_SNACKBAR",{message:"ws\u94FE\u63A5\u5C1A\u672A\u5B8C\u6210\u521D\u59CB\u5316\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",color:"warning"}),i.value=!1)},1e3)}else u.value.password="",o.value.title="\u767B\u5F55\u5931\u8D25",o.value.text="\u7528\u6237\u540D\u6216\u5BC6\u7801\u9519\u8BEF",i.value=!1,a.commit("app/ADD_SNACKBAR",{message:"\u767B\u5F55\u5931\u8D25\uFF0C\u7528\u6237\u540D\u6216\u5BC6\u7801\u9519\u8BEF\uFF01",color:"error"})}).catch(h=>{o.value.title="\u670D\u52A1\u5668\u53D1\u751F\u5F02\u5E38",o.value.text=h.message,i.value=!1,a.commit("app/ADD_SNACKBAR",{message:"\u767B\u9646\u5931\u8D25\uFF0C\u670D\u52A1\u5668\u53D1\u751F\u5F02\u5E38\uFF01",color:"error"}),console.log(h)})},C=()=>{a.commit("app/SET_RUNMODE","offline"),a.commit("app/SET_APPSERVERAPI",""),a.dispatch("user/login",{user:"\u79BB\u7EBF\u7528\u6237",permissions:"",token:"",auto:!1}),R.push({path:"/"})},_=()=>{u.value,i.value=!0;let f=window.location.origin+"/";K.post(`${f}quick`).then(l=>{i.value=!1,l.data.state?k.value=!0:(u.value.password="",o.value.title="\u767B\u5F55\u5931\u8D25",o.value.text="\u670D\u52A1\u5668\u9519\u8BEF",a.commit("app/ADD_SNACKBAR",{message:"\u767B\u5F55\u5931\u8D25\uFF0C\u670D\u52A1\u5668\u9519\u8BEF\uFF01",color:"error"}))}).catch(l=>{o.value.title="\u670D\u52A1\u5668\u53D1\u751F\u5F02\u5E38",o.value.text=l.message,i.value=!1,a.commit("app/ADD_SNACKBAR",{message:"\u767B\u9646\u5931\u8D25\uFF0C\u670D\u52A1\u5668\u53D1\u751F\u5F02\u5E38\uFF01",color:"error"}),console.log(l)})},P=()=>{i.value=!0;const f=u.value;let l=window.location.origin+"/";K.post(`${l}login`,{otp:V.value}).then(n=>{if(n.data.login){if(a.getters.serverApi!=l||w.value.readyState!=1){const h=new URL(l),D=`${h.protocol==="http:"?"ws":"wss"}://${h.host}/ws`;a.dispatch("app/initWS",D)}a.commit("app/SET_RUNMODE","online"),a.commit("app/SET_APPSERVERAPI",l),a.dispatch("user/login",{user:n.data.user,permissions:n.data.autho,token:n.data.token,auto:u.remember}),setTimeout(()=>{w.value.readyState==1?(w.value.send(JSON.stringify({command:"login",token:a.getters.userToken})),a.commit("app/ADD_SNACKBAR",{message:`${f.qq}\u767B\u9646\u6210\u529F`,color:"success"}),R.push({path:"/"})):(a.commit("app/ADD_SNACKBAR",{message:"ws\u94FE\u63A5\u5C1A\u672A\u5B8C\u6210\u521D\u59CB\u5316\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",color:"warning"}),i.value=!1)},1e3)}else u.value.password="",o.value.title="\u767B\u5F55\u5931\u8D25",o.value.text="\u7528\u6237\u540D\u6216\u5BC6\u7801\u9519\u8BEF",i.value=!1,a.commit("app/ADD_SNACKBAR",{message:"\u767B\u5F55\u5931\u8D25\uFF0C\u7528\u6237\u540D\u6216\u5BC6\u7801\u9519\u8BEF\uFF01",color:"error"})}).catch(n=>{o.value.title="\u670D\u52A1\u5668\u53D1\u751F\u5F02\u5E38",o.value.text=n.message,i.value=!1,a.commit("app/ADD_SNACKBAR",{message:"\u767B\u9646\u5931\u8D25\uFF0C\u670D\u52A1\u5668\u53D1\u751F\u5F02\u5E38\uFF01",color:"error"}),console.log(n)})};return u.value.server=window.location.origin+"/",(f,l)=>(q(),ge("div",Be,[t(De,{class:"auth-card pa-4 pt-7 app-bar-noregion","max-width":"448"},{default:d(()=>[t(he,{class:"justify-center"},{prepend:d(()=>[y("div",Fe,[y("div",{innerHTML:N(_e)},null,8,Ee)])]),default:d(()=>[t(be,{class:"font-weight-semibold text-2xl text-uppercase"},{default:d(()=>[j(" GPT\u5DE5\u5177\u7BB1 ")]),_:1})]),_:1}),o.value.title?(q(),B(ye,we(O({key:0},o.value)),null,16)):F("",!0),t(Q,{class:"pt-2"},{default:d(()=>[Ue,Ie]),_:1}),t(Q,null,{default:d(()=>[t(Ae,{onSubmit:l[5]||(l[5]=Ve(()=>{},["prevent"]))},{default:d(()=>[t(ke,null,{default:d(()=>[t(S,{cols:"12"},{default:d(()=>[t(I,{modelValue:u.value.server,"onUpdate:modelValue":l[0]||(l[0]=n=>u.value.server=n),label:"\u670D\u52A1\u5668",type:"text","append-inner-icon":"mdi-fingerprint","onClick:appendInner":_,readonly:""},null,8,["modelValue"])]),_:1}),k.value?(q(),B(S,{key:0,cols:"12"},{default:d(()=>[$e,t(N(Pe),{modelValue:V.value,"onUpdate:modelValue":l[1]||(l[1]=n=>V.value=n),loading:i.value,onFinish:P},null,8,["modelValue","loading"])]),_:1})):F("",!0),k.value?F("",!0):(q(),B(S,{key:1,cols:"12"},{default:d(()=>[t(I,{modelValue:u.value.qq,"onUpdate:modelValue":l[2]||(l[2]=n=>u.value.qq=n),label:"QQ",type:"text"},null,8,["modelValue"])]),_:1})),k.value?F("",!0):(q(),B(S,{key:2,cols:"12"},{default:d(()=>[t(I,{modelValue:u.value.password,"onUpdate:modelValue":l[3]||(l[3]=n=>u.value.password=n),label:"\u5BC6\u7801",type:x.value?"text":"password","append-inner-icon":x.value?"mdi-eye-off-outline":"mdi-eye-outline","onClick:appendInner":l[4]||(l[4]=n=>x.value=!x.value),class:"mb-4"},null,8,["modelValue","type","append-inner-icon"]),t(xe,{block:"",type:"submit",loading:i.value,onClick:v},{loader:d(()=>[t(J,{indeterminate:"",color:"white"})]),default:d(()=>[j(" \u767B\u9646 ")]),_:1},8,["loading"])]),_:1})),t(S,{cols:"12",class:"d-flex align-center"},{default:d(()=>[t(W),Ke,t(W)]),_:1}),t(S,{cols:"12",class:"text-center text-base"},{default:d(()=>[Oe,y("span",{class:"text-primary ms-2",onClick:C}," \u79BB\u7EBF\u4F7F\u7528 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t($,{class:"auth-footer-start-tree d-none d-md-block",src:N(Ce),width:250},null,8,["src"]),t($,{src:N(Te),class:"auth-footer-end-tree d-none d-md-block",width:350},null,8,["src"]),t($,{class:"auth-footer-mask d-none d-md-block",src:N(E)},null,8,["src"])]))}};typeof H=="function"&&H(Me);export{Me as default};
